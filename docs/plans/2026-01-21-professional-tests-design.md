# 专业测试用例设计方案

> 基于寿星万年历算法说明文档设计的专业测试套件

**日期：** 2026-01-21

---

## 一、测试目标

基于 `src-legacy/` 目录中的算法说明文档（sm1.htm - sm9.htm 及精度表.txt），创建一套完整的专业测试用例，验证计算精度、历史数据准确性和边界条件处理。

---

## 二、测试分类

### 1. 精度验证测试 (`precision/`)

#### 1.1 儒略日精度测试
- **来源：** sm2.htm 第二章
- **标准测试值：**
  - 2000年 1月 1.5日 → JD 2451545.0
  - 1987年 1月 27.0日 → JD 2446822.5
  - 1987年 6月 19.5日 → JD 2446966.0
  - 1988年 1月 27.0日 → JD 2447187.5
  - 1988年 6月 19.5日 → JD 2447332.0
  - 1900年 1月 1.0日 → JD 2415020.5
  - 1600年 1月 1.0日 → JD 2305447.5
  - 1600年 12月 31.0日 → JD 2305812.5
  - 837年 4月 10.3日 → JD 2026871.8
  - -1000年 7月 12.5日 → JD 1356001.0
  - -1000年 2月 29.0日 → JD 1355866.5
  - -1001年 8月 17.9日 → JD 1355671.4
  - -4712年 1月 1.5日 → JD 0.0

#### 1.2 ΔT 参考值测试
- **来源：** sm7.htm 第七章
- **历史参考值：** （年份 → ΔT秒）
  - -500年 → 17190秒 (±430)
  - 0年 → 10580秒 (±260)
  - 500年 → 5710秒 (±140)
  - 1000年 → 1570秒 (±55)
  - 1500年 → 200秒 (±20)
  - 1700年 → 9秒 (±5)
  - 1800年 → 14秒 (±1)
  - 1900年 → -3秒 (<1)
  - 1950年 → 29秒 (<0.1)
  - 2000年 → 63.8秒

#### 1.3 行星精度测试
- **来源：** 精度表.txt
- **基本精度要求（J2000±4千年）：**
  - 地球：黄经 0.1角秒
  - 水星：黄经 0.2角秒
  - 金星：黄经 0.2角秒
  - 火星：黄经 0.5角秒
  - 木星：黄经 0.5角秒
  - 土星：黄经 0.5角秒
  - 天王星：黄经 1.0角秒
  - 海王星：黄经 1.0角秒

#### 1.4 月球坐标精度测试
- **来源：** sm1.htm
- **精度要求：**
  - 黄经精度：0.5角秒
  - 黄纬精度：0.5角秒
  - 距离精度：1千米
- **参考值：**
  - 2008年1月6日 0h TD：视黄经 256°54'36.31"，视黄纬 -4°52'14.12"
  - 距离：401817.73千米

### 2. 历史数据验证测试 (`historical/`)

#### 2.1 古代历法平朔参数验证
- **来源：** sm1.htm
- **参数表：**
  - 春秋：b=1457698.231017, k=29.53067166
  - 战国：b=1546082.512234, k=29.53085106
  - 秦汉：b=1642472.151543, k=29.53085439
  - 太初历：b=1683430.509300, k=29.53086148
  - 四分历：b=1752148.041079, k=29.53085097
  - ... (详见文档)

#### 2.2 已知历史数据错误验证
- **来源：** sm1.htm
- **《三千五百年历日天象》错误：**
  - 朔的修改：如 -701年 06.02 改 06.01
  - 节气订正：如 -214年 九月份 廿六 改 廿七

#### 2.3 1501-1940颁行历朔日差异
- **来源：** sm1.htm 表格
- **天象日期 vs 古历日期差异表：**
  - 1501-06-16 六月 → 06-15
  - 1508-01-02 十二 → 01-03
  - ... (共约50条)

### 3. 边界条件测试 (`boundary/`)

#### 3.1 儒略历/格里历切换
- 1582年10月4日（儒略历）→ 1582年10月15日（格里历）
- 测试10月5-14日不存在

#### 3.2 年份边界
- 天文纪年与历史纪年转换
- 公元0年存在性
- 负年份闰年判断

#### 3.3 农历特殊现象
- **来源：** sm5.htm
- 一个月包含两个中气
- 只有12个月的年份中无中气月不置闰
- 冬至所在月必为年首

#### 3.4 ΔT 外推边界
- 2050年前后过渡平滑性
- 2150年后外推公式
- -500年以前外推

### 4. 日月食验证测试 (`eclipse/`)

#### 4.1 月食计算
- **来源：** sm8.htm
- 本影半径公式：er = r/d - (R-r)/D
- 半影半径公式：Er = r/d + (R+r)/D
- 地球大气修正系数：1.02

#### 4.2 日食计算
- **来源：** sm9.htm
- 贝塞尔坐标变换验证
- 本影锥与地球交点计算

### 5. 干支纪法测试 (`ganzhi/`)

#### 5.1 干支纪年
- **来源：** sm5.htm
- 1984年为甲子年
- 2000年为庚辰年

#### 5.2 干支纪月
- 1998年12月7日（大雪）为甲子月

---

## 三、测试文件结构

```
tests/professional/
├── precision/
│   ├── julian-precision.test.ts      # 儒略日精度
│   ├── delta-t-reference.test.ts     # ΔT参考值
│   ├── planet-precision.test.ts      # 行星精度
│   └── moon-precision.test.ts        # 月球精度
├── historical/
│   ├── ancient-calendar.test.ts      # 古代历法参数
│   ├── historical-errors.test.ts     # 已知历史错误
│   └── shorun-differences.test.ts    # 朔闰差异表
├── boundary/
│   ├── calendar-switch.test.ts       # 历法切换
│   ├── year-boundary.test.ts         # 年份边界
│   ├── lunar-special.test.ts         # 农历特殊现象
│   └── delta-t-extrapolation.test.ts # ΔT外推
├── eclipse/
│   ├── lunar-eclipse-algorithm.test.ts # 月食算法
│   └── solar-eclipse-bessel.test.ts    # 日食贝塞尔
└── ganzhi/
    └── ganzhi-calculation.test.ts    # 干支计算
```

---

## 四、预期成果

- 测试用例数量：150+ 个
- 覆盖文档中所有可测试的标准数据
- 验证算法精度在规定范围内
- 确保历史数据处理正确
- 边界条件处理完善
